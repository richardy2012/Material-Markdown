<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../settings-routes.html">
<link rel="import" href="../io-behavior/io-behavior.html">

<dom-module id="app-settings">

  <style>
    :host {
      display: block;
    }

    .menubar{
      -webkit-app-region: drag;
      -webkit-user-select: none;
      border-radius: 0;
    }
    .small-icon {
      --iron-icon-height: 18px;
      --iron-icon-width: 18px;
      padding: 0;
      margin: 0;
      -webkit-app-region: no-drag;
    }
    paper-menu iron-icon {
      margin-right: 33px;
      opacity: 0.54;
    }
    paper-menu a {
      text-decoration: none;
      display: -ms-flexbox;
      display: -webkit-flex;
      display: flex;
      -ms-flex-direction: row;
      -webkit-flex-direction: row;
      flex-direction: row;
      -ms-flex-align: center;
      -webkit-align-items: center;
      align-items: center;
      -webkit-font-smoothing: antialiased;
      font-size: 14px;
      font-weight: 400;
      line-height: 24px;
      min-height: 48px;
      padding: 0 16px;
    }
    paper-card {
      --paper-card-header: {
        background-color: #303F9F;
      }
      --paper-card-header-color: #fff;
    }
    paper-card {
      max-width: 640px;
      margin: 16px;
    }
    paper-card img{
      padding: 15px;
    }
    .option{
      padding: 3px;
    }
    paper-toggle-button{
      --paper-toggle-button-checked-bar-color:  #E91E63;
      --paper-toggle-button-checked-button-color:  #E91E63;
      --paper-toggle-button-checked-ink-color: #E91E63;
    }

    .dropdown-option{
      padding-top: 5px;
    }

  </style>

  <template id="settings">

    <div class = "layout horizontal start menubar" style = "height: 20px; width = 100%; background: #2196F3;">
      <paper-icon-button class="small-icon" icon="close" id = "settings-close"></paper-icon-button>
      <paper-icon-button class="small-icon" icon="remove" id = "settings-minimize"></paper-icon-button>
      <paper-icon-button class="small-icon" icon="fullscreen" id = "settings-fullscreen"></paper-icon-button>
    </div>

    <paper-drawer-panel id="drawerPanel" responsive-width="600px" style = 'top: 20px; height: calc(100% - 20px)'>

        <div class="nav" drawer fixed>
          <paper-header-panel>
            <paper-toolbar>
              <div class="title">Settings</div>
            </paper-toolbar>
            <paper-menu>

              <a data-route="settings" href="/">
                <iron-icon icon="settings"></iron-icon>
                <span>General</span>
              </a>

              <a data-route="editor" href="/editor">
                <iron-icon icon="create"></iron-icon>
                <span>Editor</span>
              </a>

              <a data-route="markdown" href="/markdown">
                <iron-icon icon="extension"></iron-icon>
                <span>Markdown</span>
              </a>

              <a data-route="theming" href="/theming">
                <iron-icon icon="invert-colors"></iron-icon>
                <span>Theming</span>
              </a>

              <a data-route="outputStyles" href="/outputStyles">
                <iron-icon icon="image:color-lens"></iron-icon>
                <span>Output Styles</span>
              </a>
            </paper-menu>
          </paper-header-panel>

        </div>

        <paper-scroll-header-panel class="main" main fixed>

          <!-- Main Toolbar -->
          <paper-toolbar>
            <paper-icon-button icon="menu" paper-drawer-toggle></paper-icon-button>
          </paper-toolbar>

          <!-- Main Content -->
          <div class="content">
            <iron-pages attr-for-selected="data-route" selected="{{route}}">

              <section data-route = "general" class = 'content-section'>
                <div class="layout vertical center">
                  <paper-card heading = "On Startup" image="images/random-background.svg" elevation = "2">
                    <div class="card-content">
                      <div class="layout horizontal option"><span class = 'flex'>Show edit ribbon on start</span><paper-toggle-button id = "showRibbonOnStart"></paper-toggle-button></div>
                      <div class="layout horizontal option"><span class = 'flex'>Enable autorendering</span><paper-toggle-button id = "autorendering"></paper-toggle-button></div>
                      <!-- Need to make settings a separate element to make this easier -->
                      <div class="layout horizontal option"><span class = 'flex'>Show Word Count</span><paper-toggle-button id = "showWordCount"></paper-toggle-button></div>
                    </div>
                  </paper-card>
                </div>
              </section>

              <section data-route = "editor" class = 'content-section'>
                <div class="layout vertical center">
                  <!-- <paper-card heading = "Defaults" image="images/random-background.svg" class = "no-bottom-title-padding" elevation = "2">
                    <div class="card-content">

                      <div class="layout horizontal center option"><span class = 'flex dropdown-option'>Default Font</span>
                        <paper-dropdown-menu label = "Default Font">
                          <paper-menu class="dropdown-content">
                            <template is = "dom-repeat" items = "[[fonts]]">
                              <paper-item>[[item]]</paper-item>
                            </template>
                          </paper-menu>
                        </paper-dropdown-menu>
                      </div>

                      <div class="layout horizontal center option"><span class = 'flex dropdown-option'>Default Font Size</span>
                        <paper-dropdown-menu label = "Default Font Size">
                          <paper-menu class="dropdown-content">
                            <template is = "dom-repeat" items = "[[fontSizes]]">
                              <paper-item>[[item]]</paper-item>
                            </template>
                          </paper-menu>
                        </paper-dropdown-menu>
                      </div>

                      <div class="layout horizontal center option"><span class = 'flex dropdown-option'>Default Theme</span>
                        <paper-dropdown-menu label = "Default Theme">
                          <paper-menu class="dropdown-content">
                            <template is = "dom-repeat" items = "[[editorThemes]]">
                              <paper-item>[[item]]</paper-item>
                            </template>
                          </paper-menu>
                        </paper-dropdown-menu>
                      </div>
                    </div>
                  </paper-card> -->
                  <paper-card heading = "Configurations" image="images/random-background.svg" elevation = "2">
                    <div class="card-content">
                      <div class="layout horizontal option"><span class = 'flex'>Code Folding</span><paper-toggle-button id = "codeFolding"></paper-toggle-button></div>
                      <div class="layout horizontal option"><span class = 'flex'>Show line numbers</span><paper-toggle-button id = "lineNumbers"></paper-toggle-button></div>

                    </div>
                  </paper-card>
                </div>
              </section>

              <section data-route = "markdown" class = 'content-section'>
                <div class="layout vertical center">
                  <paper-card heading = "Extending Rules" image="images/random-background.svg" elevation = "2">
                    <div class="card-content">

                    </div>
                  </paper-card>
                </div>
              </section>

              <section data-route = "theming" class = 'content-section'>
                <div class="layout vertical center">
                  <paper-card heading = "On Startup" image="images/random-background.svg" class = "no-bottom-title-padding" elevation = "2">
                    <div class="card-content">
                      <div class="layout horizontal center option"><span class = 'flex dropdown-option'>Primary Color</span>
                        <paper-dropdown-menu label = "Primary Color" selectedItem = "{{primaryColor}}">

                          <paper-menu class="dropdown-content">
                            <paper-item style = "color: #303F9F;">Indigo</paper-item>
                            <paper-item style = "color: #512DA8;">Deep Purple</paper-item>
                            <paper-item style = "color: #1976D2;">Blue</paper-item>
                            <paper-item style = "color: #FF5722;">Deep Orange</paper-item>
                          </paper-menu>

                        </paper-dropdown-menu>
                      </div>
                      <div class="layout horizontal center option"><span class = 'flex dropdown-option'>Accent Color</span>

                        <paper-dropdown-menu label = "Accent Color" selectedItem = "{{accentColor}}">

                          <paper-menu class="dropdown-content">
                            <paper-item style = "color: #FF4081;">Pink</paper-item>
                            <paper-item style = "color: #7C4DFF;">Purple</paper-item>
                            <paper-item style = "color: #1976D2;">Blue</paper-item>
                            <paper-item style = "color: #FFEB3B;">Yellow</paper-item>
                          </paper-menu>

                        </paper-dropdown-menu>
                      </div>
                    </div>
                  </paper-card>
                </div>
              </section>

              <section data-route = "outputStyles" class = 'content-section'>
                <!-- <styles-editor wrap></styles-editor> -->
                <div class="layout vertical center">
                  <paper-card heading = "Active Stylesheet" image="images/random-background.svg" elevation = "2">
                    <div class="card-content">
                      <div class="layout horizontal center option">
                        <span class = 'flex'>Choose a stylesheet</span>
                        <paper-dropdown-menu id = "selectActiveStylesheet" label = "Select Theme">
                          <paper-menu class="dropdown-content">
                          <template is = "dom-repeat" items = "[[outputThemes]]">
                            <paper-item>[[item]]</paper-item>
                          </template>
                          </paper-menu>
                        </paper-dropdown-menu>
                      </div>
                      <div class="layout horizontal">
                        <paper-button class = "flex" raised on-tap = "addTheme">Add a theme (.css file)</paper-button>
                      </div>
                    </div>
                  </paper-card>
                </div>
              </section>

            </iron-pages>
          </div>

        </paper-scroll-header-panel>

      </paper-drawer-panel>
  </template>

  <script>
  (function() {
    Polymer({
      is: 'app-settings',

      behaviors: [MarkdownBehaviors.IoBehavior],

      properties: {
        fontSizes: {
          type: Array,
          value: function(){
            var sizes = [];
            for (var i = 10; i < 26; i++){
              sizes.push(i);
            }
            return sizes;
          }
        },
        fonts: {
          type: Array,
          value: function(){
            return ['Cutive_Mono', 'Roboto_Mono', 'Nova_Mono', 'Share_Tech_Mono', 'Source_Code_Pro'];
          }
        },
        editorThemes: {
          type: Array,
          value: function(){
            return ['ambiance','chaos','chrome','clouds','clouds_midnight', 'cobalt', 'crimson_editor', 'dawn', 'dreamweaver', 'eclipse', 'github', 'idle_fingers', 'iplastic', 'katzenmilch',
                          'kr_theme', 'kuroir', 'merbivore', 'merbivore_soft', 'mono_industrial', 'monokai', 'pastel_on_dark', 'solarized_dark', 'solarized_light', 'sqlserver', 'terminal',
                          'textmate', 'tomorrow', 'tomorrow_night', 'tomorrow_night_blue', 'tomorrow_night_bright', 'tomorrow_night_eighties', 'twilight', 'vibrant', 'vibrant_ink', 'xcode'];
          }
        },
        outputThemes: {
          type: Array,
          value: function(){
            return ['Github'];
          }
        },
        primaryColor: {
          type: String
        },
        accentColor: {
          type: String
        },
        settings: {
          type: Object
        }
      },

      ready: function(){
        this.readSettings();
      },

      /*
       * Read the settings from settings.json and set the values in the settings window
       */
      readSettings: function(){
        var settingsString = this.fs.readFileSync(__dirname + '/settings.json').toString();
        console.log(settingsString);
        this.settings = JSON.parse(settingsString);
        // General settings
        this.$.showRibbonOnStart.checked = this.settings.general.showRibbonOnStart; //true
        console.log(this.settings.general.showRibbonOnStart);
        this.$.autorendering.checked = this.settings.general.autorendering; //true
        console.log(this.settings.general.autorendering);
        this.$.showWordCount.checked = this.settings.general.showWordCount; //false
        console.log(this.settings.general.showWordCount);
        // Editor settings
        this.$.codeFolding.checked = this.settings.editor.codeFolding;
        this.$.lineNumbers.checked = this.settings.editor.lineNumbers;
        // Markdown settings...nothing for now

        // Theming settings
        this.primaryColor = this.settings.theming.primaryColor;
        this.accentColor = this.settings.theming.accentColor;

        // Output styles settings
      },

      /*
       * Write the settings to settings.json. Settings are then read in settings-config.js to inject changes into the editor
       */
      returnModifiedSettings: function(){
        if (!this.settings){
          console.log("settings object is not defined");
          return;
        }
        // Copy a reference to the settings object
        var tempSettings = this.settings;
        // General settings
        tempSettings.general.showRibbonOnStart = this.$.showRibbonOnStart.checked;
        tempSettings.general.autorendering = this.$.autorendering.checked;
        tempSettings.general.showWordCount = this.$.showWordCount.checked;
        // Editor settings
        tempSettings.editor.codeFolding = this.$.codeFolding.checked;
        tempSettings.editor.lineNumbers = this.$.lineNumbers.checked;
        // Markdown settings...nothing for now

        // Theming settings
        tempSettings.theming.primaryColor = this.primaryColor;
        tempSettings.theming.accentColor = this.accentColor;

        // Output styles settings

        // this.fs.writeFileSync(__dirname + '/settings.json', JSON.stringify(tempSettings, null, 2));
        return tempSettings;
      },

      addTheme: function(){
        var remote = require('remote');
        var dialog = remote.require('dialog');
        var files = dialog.showOpenDialog({ properties: ['openFile']});
        var file = files[0];
        if (file){
          this.push('outputThemes', this.path.basename(file));
        }
      }

    });
  })();
  </script>
</dom-module>
